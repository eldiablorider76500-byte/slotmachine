<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Machine à sous 3B</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #fff;
    }

    /* CONTENEUR = ta machine (image de fond) */
    .slot-wrapper {
      position: relative;
      width: min(1280px, 100vw);
      aspect-ratio: 16 / 9;
      background-image: url("machine-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* ZONE DES ROULEAUX (à placer sur la vitre de ta machine) */
    .reels-zone {
      position: absolute;
      /* Ces valeurs sont à ajuster pour que ça tombe pile dans ta fenêtre */
      left: 23%;
      top: 26%;
      width: 54%;
      height: 40%;

      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.8%;
      pointer-events: none;
    }

    .reel {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      border-radius: 10px;
      /* léger glow blanc comme les machines */
      box-shadow: inset 0 0 8px rgba(0,0,0,0.8), 0 0 16px rgba(255,255,255,0.35);
    }

    /* fond neutre (si jamais les images de symboles ne se chargent pas) */
    .reel-bg {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, #222c, #020617 70%);
    }

    .reel-strip {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      will-change: transform;
    }

    .symbol-cell {
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
    }

    .symbol-img {
      max-width: 80%;
      max-height: 80px;
      object-fit: contain;
      filter: drop-shadow(0 0 6px rgba(0,0,0,0.9));
    }

    /* Quand ça tourne : petit effet intense */
    .reel.spinning {
      box-shadow:
        inset 0 0 8px rgba(0,0,0,0.9),
        0 0 20px rgba(255,255,255,0.7);
    }

    /* Barre de texte en bas (gagné / perdu / attente) */
    .status-bar {
      position: absolute;
      left: 50%;
      bottom: 4%;
      transform: translateX(-50%);
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,0.7);
      font-size: 14px;
      text-align: center;
      min-width: 40%;
    }

    .status-win { color: #4ade80; }
    .status-lose { color: #fb923c; }
    .status-wait { color: #e5e7eb; }

    /* Bouton de test (pour toi, tu pourras le virer ensuite) */
    .test-controls {
      position: absolute;
      right: 3%;
      bottom: 8%;
      pointer-events: auto;
    }

    .btn-spin {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      background: linear-gradient(90deg, #22c55e, #16a34a);
      color: #022c22;
      box-shadow: 0 0 12px rgba(34,197,94,0.85);
    }

    .btn-spin:active { transform: translateY(1px); }

    @media (max-width: 768px) {
      .symbol-cell { height: 70px; }
      .symbol-img { max-height: 60px; }
      .status-bar { font-size: 11px; padding: 4px 10px; }
    }
  </style>
</head>

<body>
  <div class="slot-wrapper">
    <!-- LES 4 ROULEAUX seront injectés ici -->
    <div id="reelsZone" class="reels-zone"></div>

    <!-- texte d’état -->
    <div id="status" class="status-bar status-wait">
      En attente de cadeau TikTok…
    </div>

    <!-- bouton test -->
    <div class="test-controls">
      <button id="btnSpin" class="btn-spin">SPIN TEST</button>
    </div>
  </div>

  <script>
    /*************************************************
     * CONFIG : symboles (tu pourras remplacer par tes PNG TikTok)
     **************************************************/
    const SYMBOLS = [
      { id: "rose",    file: "symbols/rose.png"    },
      { id: "donut",   file: "symbols/donut.png"   },
      { id: "galaxy",  file: "symbols/galaxy.png"  },
      { id: "lion",    file: "symbols/lion.png"    },
    ];

    const NB_REELS = 4;
    const VISIBLE_ROWS = 3;
    const STRIP_LENGTH = 18; // nb de cases dans le strip

    const reelsZone = document.getElementById("reelsZone");
    const statusBar = document.getElementById("status");
    const spinBtn = document.getElementById("btnSpin");

    let isSpinning = false;

    /*************************************************
     * Création des rouleaux au chargement
     **************************************************/
    function createReels() {
      for (let r = 0; r < NB_REELS; r++) {
        const reel = document.createElement("div");
        reel.className = "reel";

        const reelBg = document.createElement("div");
        reelBg.className = "reel-bg";

        const strip = document.createElement("div");
        strip.className = "reel-strip";

        // on remplit avec des symboles (au hasard, neutre)
        for (let i = 0; i < STRIP_LENGTH; i++) {
          const cell = document.createElement("div");
          cell.className = "symbol-cell";

          const img = document.createElement("img");
          img.className = "symbol-img";

          const sym = SYMBOLS[i % SYMBOLS.length];
          img.src = sym.file;
          img.alt = sym.id;

          cell.appendChild(img);
          strip.appendChild(cell);
        }

        reel.appendChild(reelBg);
        reel.appendChild(strip);
        reelsZone.appendChild(reel);
      }
    }

    /*************************************************
     * Animation d’un spin
     **************************************************/
    function spinOnce(resultSymbolId = null, viewerName = "Test") {
      if (isSpinning) return;
      isSpinning = true;

      statusBar.textContent = `Spin en cours pour ${viewerName}…`;
      statusBar.className = "status-bar status-wait";

      const reels = Array.from(document.querySelectorAll(".reel"));

      reels.forEach((reel, index) => {
        const strip = reel.querySelector(".reel-strip");
        const cells = strip.children;

        // hauteur d’un symbole
        const symbolHeight = cells[0].getBoundingClientRect().height;

        // on mélange les symboles pour l’animation
        for (let i = 0; i < STRIP_LENGTH; i++) {
          const sym = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
          const img = cells[i].querySelector("img");
          img.src = sym.file;
          img.alt = sym.id;
        }

        // forcer le layout
        strip.style.transition = "none";
        strip.style.transform = "translateY(0px)";
        // petit trick pour que le browser prenne le changement
        void strip.offsetHeight;

        // durée différente pour chaque rouleau
        const duration = 900 + index * 250;
        const easing = "cubic-bezier(0.15,0.85,0.25,1)";

        // position finale
        const finalIndex = STRIP_LENGTH - VISIBLE_ROWS;
        const translateY = -finalIndex * symbolHeight;

        reel.classList.add("spinning");
        strip.style.transition = `transform ${duration}ms ${easing}`;
        strip.style.transform = `translateY(${translateY}px)`;

        // à la fin du mouvement, on nettoie
        setTimeout(() => {
          reel.classList.remove("spinning");

          if (index === reels.length - 1) {
            // arrêt du dernier rouleau => on décide win/lose
            finishSpin(resultSymbolId, viewerName);
          }
        }, duration + 50);
      });
    }

    function finishSpin(resultSymbolId, viewerName) {
      isSpinning = false;

      if (resultSymbolId) {
        statusBar.textContent =
          `${viewerName} a gagné : 4 x ${resultSymbolId.toUpperCase()} !`;
        statusBar.className = "status-bar status-win";
      } else {
        statusBar.textContent = `${viewerName} n'a pas gagné cette fois.`;
        statusBar.className = "status-bar status-lose";
      }
    }

    /*************************************************
     * Intégration TikTok plus tard :
     * tu appelleras juste spinForViewer(pseudo, "rose")
     **************************************************/
    function spinForViewer(viewerName, symbolId) {
      spinOnce(symbolId, viewerName);
    }

    // Bouton de test
    spinBtn.addEventListener("click", () => {
      // pour le test, on fait gagner 1 fois sur 3
      const win = Math.random() < 0.33;
      const symbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
      spinOnce(win ? symbol.id : null, "TestViewer");
    });

    // init
    window.addEventListener("load", () => {
      createReels();
    });
  </script>
</body>
</html>
  
